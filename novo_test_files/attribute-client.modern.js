function t(){return t=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},t.apply(this,arguments)}function n(t){const n=document.cookie.match("(^|;) ?"+t+"=([^;]*)(;|$)");return n?n[2]:null}function e(t=[]){return 0===t.length||t.map(t=>n(t)).every(t=>null!==t)}function i(t){return new Promise(function(n){setTimeout(n,t)})}console.log("attribute-client v0.3"),(()=>{const o="aff\nafftrack\naff_model\nreferrer\nclickid\nfbclid\ngclid\nretrack\nfingerprint\nutm_source\nutm_medium\nutm_campaign\nutm_network\nutm_placement\nutm_ad_position\nutm_creative\nutm_match_type\nutm_keyword\nutm_device\nutm_device_model\nutm_adwords_product_target_id\nutm_content\nutm_term".split("\n"),r="https://iqoption.com/lp/attribute,https://iqbroker.co/lp/attribute".split(",");let c=document.currentScript.getAttribute("data-domain")||"/lp/attribute",a=(document.currentScript.getAttribute("data-cookie")||"").split(",").map(t=>t.trim()).filter(t=>""!==t);function d(t){return fetch(t+"/api/check-leadId/1.0",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(t=>t.json())}function l({touchId:t,leadId:n}){return fetch(c+"/api/update-leadId/1.0",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({touch_id:t,lead_id:n})})}(async()=>{if(a.length>0){const t=9;for(let n=1;n<=t&&!e(a);n++)await i(800)}var u;(u=function(t=[]){let e=new URLSearchParams(location.search),i={};e.forEach((t,n)=>{o.includes(n)&&(i[n]=t)});for(let e of t){let t=n(e);null!==t&&(i[e]=t)}return i}(a),fetch(c+"/api/create-touch/1.0",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).then(t=>t.json()).catch(t=>{console.error("Error:",t)})).then(n=>async function(n){window.attribute=t({},window.attribute,{touch_id:n});let e="";for(const t of r){if(t.includes(window.location.hostname))continue;let i=await d(t);if(!i.lead_id)continue;const o=i.lead_id;e!==o&&(await l({touchId:n,leadId:o}),e=o)}}(n.touch_id)).catch(t=>console.error("Error: ",t))})(),window.affiliateCounter=function({trackerApi:t,brandId:n}){if(!t||!n||!t.includes("int."))return console.error("affiliateCounter invalid config"),void console.log({trackerApi:t,brandId:n});window.location.host.includes("int.")||(t=t.replace("int.",""));const e=new URLSearchParams(window.location.search),i=e.get("aff");let o=e.get("afftrack");const r=e.get("aff_model"),c=e.get("clickid"),a=e.get("gclid");if(!i)return;c?o+="__clickid-"+c:a&&(o+="__CONVTRANSFR__clickid-"+a);const d={aff_id:i,aff_track:o||"",aff_model:r||"",brand_id:n,rand:Math.random()},l=new URLSearchParams(d).toString();fetch(`${t}?${l}`,{method:"GET",mode:"cors",credentials:"include"})}})();
